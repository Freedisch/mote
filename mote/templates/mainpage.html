{% extends "base.html.j2" %}
{% block head %}
        <link href="{{ url_for('static', filename='css3/fullcalendar.css') }}" rel="stylesheet"/>
        <script src="{{ url_for('static', filename='jscn/socket.io.js') }}"></script>
        <script src="{{ url_for('static', filename='jscn/fullcalendar.js') }}"></script>
        <script src="{{ url_for('static', filename='jscn/calview.js') }}"></script>
{% endblock %}

{% block content %}
            <div class="card mt-1">
                <div class="card-body">
                    <div class="">
                        <div class="font-alt">
			    <div class="btn-toolbar justify-content-between p-3 pt-0" role="toolbar" aria-label="Calendar navigation bar">
			    <div class="cal-title mb-2 mb-lg-0 mx-auto mx-lg-0">
                              <span id="spin" class="far fa-calendar" aria-hidden="true"></span>Meetings by Date
			    </div>


			    <div class="btn-group cal-nav mb-2 mb-lg-0 mx-auto mx-lg-0" role="group" aria-label="Calendar navigation">
                              <button type="button" class="btn btn-outline-primary" id="prev"><span class="fas fa-angle-left fa-lg" aria-hidden="true"></span></button>
                              <button type="button" class="btn btn-outline-primary" disabled id="curDate"></button>
                              <button type="button" class="btn btn-outline-primary" id="next"><span class="fas fa-angle-right fa-lg" aria-hidden="true"></span></button>
                            </div>

			    <div class="btn-group mb-2 mb-lg-0 mx-auto mx-lg-0" role="group" aria-label="Calendar view">
                              <button type="button" class="btn btn-outline-primary" id="day"><i class="fas fa-calendar-day fa-lg" aria-hidden="true"></i> Day</button>
                              <button type="button" class="btn btn-outline-primary active" id="week"><i class="fas fa-calendar-week fa-lg" aria-hidden="true"></i> Week</button>
                              <button type="button" class="btn btn-outline-primary" id="month"><i class="fas fa-calendar-alt fa-lg" aria-hidden="true"></i> Month</button>
                              <button type="button" class="btn btn-outline-primary" id="today">Today</button>
                            </div>

			    </div>
                            <div id='calendar'></div>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-center">
                    <span class="small">
                        <a
                           href="https://github.com/t0xic0der/fragment/"
                           target="_blank">
                            Fragment

                        </a>
                        &copy 2021

                        <a
                           href="https://github.com/t0xic0der"
                           target="_blank">
                            Akashdeep Dhar
                        </a>
                        and
                        <a
                           href="https://github.com/t0xic0der/fragment/graphs/contributors"
                           target="_blank">
                            others
                        </a>
                    </span>
                </div>
            </div>
{% endblock %}

{% block tail %}
        <div class="modal fade"
             aria-hidden="true"
             data-bs-backdrop="static"
             data-bs-keyboard="true"
             id="findmode">
            <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-lg-down modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header justify-content-center p-2">
                        <h6 class="modal-title head fw-bold">Lookup discussions</h6>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div class="input-group mb-3">
                                <input type="text"
                                       class="form-control"
                                       placeholder="Search for your meetings"
                                       aria-label="Search for your meetings"
                                       aria-describedby="findtext"
                                       id="findtext">
                                <button class="btn btn-outline-secondary"
                                        type="button"
                                        id="findbutn"
                                        onclick="search_meetings();">
                                    Search
                                </button>
                            </div>
                            <div class="card mb-3 mt-3" id="find-body"></div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-center text-white p-1">
                        <div class="float-right">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0"
                                    data-bs-dismiss="modal">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="true" id="chanmode">
            <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-lg-down modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header justify-content-center p-2">
                        <h6 class="modal-title head fw-bold">Explore meetings</h6>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div class="card mb-3">
                                <div class="list-group-item bg-light">
                                    <span id="chanhead" class="fw-bold">Loading...</span>
                                </div>
                            </div>
                            <div class="card">
                                <ul class="list-group list-group-flush" id="listchan-uols"></ul>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-between p-1">
                        <div class="float-left">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0 disabled"
                                    id="chanback">
                                Back
                            </button>
                        </div>
                        <span class="small fst-italic" id="chanfoot">
                            <span class="spinner-border spinner-border-sm mt-2" role="status" aria-hidden="true"></span>
                        </span>
                        <div class="float-right">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0"
                                    data-bs-dismiss="modal">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="true" id="datemode">
            <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-lg-down modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header justify-content-center p-2"> 
                        <h6 class="modal-title head fw-bold">Explore meetings</h6>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div class="card mb-3">
                                <div class="list-group-item bg-light">
                                    <span id="datehead" class="fw-bold">Loading...</span>
                                </div>
                            </div>
                            <div class="card">
                                <ul class="list-group list-group-flush" id="listdate-uols"></ul>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-between p-1">
                        <div class="float-left">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0"
                                    id="dateback"
                                    data-bs-toggle="modal"
                                    data-bs-dismiss="modal"
                                    data-bs-target="#chanmode">
                                Back
                            </button>
                        </div>
                        <span class="small fst-italic" id="datefoot">
                            <span class="spinner-border spinner-border-sm mt-2" role="status" aria-hidden="true"></span>
                        </span>
                        <div class="float-right">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0"
                                    data-bs-dismiss="modal">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade"
             aria-hidden="true"
             data-bs-backdrop="static"
             data-bs-keyboard="true"
             id="meetmode">
            <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-lg-down modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header justify-content-center p-2">
                        <h6 class="modal-title head fw-bold">Explore meetings</h6>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div class="card mb-3">
                                <div class="list-group-item bg-light">
                                    <span id="meethead" class="fw-bold">Loading...</span>
                                </div>
                            </div>
                            <div class="card">
                                <ul class="list-group list-group-flush" id="listmeet-uols"></ul>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-between p-1">
                        <div class="float-left">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0"
                                    id="meetback"
                                    data-bs-toggle="modal"
                                    data-bs-dismiss="modal"
                                    data-bs-target="#datemode">
                                Back
                            </button>
                        </div>
                        <span class="small fst-italic" id="meetfoot">
                            <span class="spinner-border spinner-border-sm mt-2" role="status" aria-hidden="true"></span>
                        </span>
                        <div class="float-right">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0"
                                    data-bs-dismiss="modal">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade"
             aria-hidden="true"
             data-bs-backdrop="static"
             data-bs-keyboard="true"
             id="rcntmode">
            <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-lg-down modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header justify-content-center p-2">
                        <h6 class="modal-title head fw-bold">Recent conversations</h6>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div class="card mb-3">
                                <div class="list-group-item bg-light">
                                    <span id="rcnthead" class="fw-bold">Loading...</span>
                                </div>
                            </div>
                            <nav>
                                <div class="nav justify-content-center nav-tabs" role="tablist">
                                    <button class="nav-link active"
                                            id="daya-head"
                                            data-bs-toggle="tab"
                                            data-bs-target="#daya-cont"
                                            type="button"
                                            role="tab"
                                            aria-controls="data-cont"
                                            aria-selected="false">
                                        <span>Last day</span>
                                    </button>
                                    <button class="nav-link"
                                            id="week-head"
                                            data-bs-toggle="tab"
                                            data-bs-target="#week-cont"
                                            type="button"
                                            role="tab"
                                            aria-controls="week-cont"
                                            aria-selected="true">
                                        <span>Last week</span>
                                    </button>
                                </div>
                            </nav>
                            <div class="tab-content mt-3">
                                <div class="tab-pane fade show active"
                                     id="daya-cont"
                                     role="tabpanel"
                                     aria-labelledby="daya-head">
                                    <ul class="list-group list-group-flush" id="listrcnt-daya-uols"></ul>
                                    <div id="none-daya"></div>
                                </div>
                                <div class="tab-pane fade"
                                     id="week-cont"
                                     role="tabpanel"
                                     aria-labelledby="week-head">
                                    <ul class="list-group list-group-flush" id="listrcnt-week-uols"></ul>
                                    <div id="none-week"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-center text-white p-1">
                        <div class="float-right">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0"
                                    data-bs-dismiss="modal">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="toast-container position-fixed bottom-0 end-0 p-3"> 
        </div>
        <div class="modal fade" id="evt-smry">
            <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-lg-down modal-dialog-scrollable">
	        <div class="modal-content"></div>
	    </div>
	</div>
{% endblock %}

{% block endpage %}
    <script>
        var socket = io.connect();
        function meetingEnded(msg){
            var meet_dt = new Date(msg['details']['time_'] * 1000);
            var toastDiv = $(`
                <div class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header">
                        <strong class="me-auto">
                            Meeting <a href="`+ msg['url'] +`.html" style="font-style: italic;" target="_blank">`+ msg['meeting_topic'] +`</a> has ended
                        </strong>
                        <small>`+ meet_dt.toLocaleTimeString() +`</small>
                        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
                `);
            var parentDiv = $('.toast-container');
            $(parentDiv).append(toastDiv);
            var toast = new bootstrap.Toast(toastDiv, {autohide: false});
            toast.show();
        }
        socket.on("show_toast", function (msg) {
            meetingEnded(msg);
        });
    </script>
{% endblock %}

